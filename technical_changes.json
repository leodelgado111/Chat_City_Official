{
  "metadata": {
    "project": "Chat City Official",
    "purpose": "Permanent record of all technical changes",
    "rules": [
      "Append-only log - never delete or modify existing entries",
      "Every change must be documented"
    ],
    "categories": [
      "Feature",
      "Bug Fix",
      "Refactor",
      "Configuration",
      "Documentation",
      "Security",
      "Performance",
      "UI",
      "UX"
    ]
  },
  "entries": [
    {
      "id": 1,
      "date": "2025-01-23",
      "time": null,
      "author": "Initial Creation",
      "category": "Documentation",
      "files": ["TECHNICAL_CHANGES_LOG.md (created)"],
      "description": "Created technical changes log file to track all project modifications",
      "technical_details": [
        "Established append-only log format",
        "Created template for consistent logging",
        "Set up categories for different types of changes"
      ],
      "breaking_changes": false,
      "testing_notes": "N/A - Documentation only",
      "related_issues": null,
      "code_snippets": null
    },
    {
      "id": 2,
      "date": "2025-01-23",
      "time": null,
      "author": "Project State Documentation",
      "category": "Documentation",
      "files": ["TECHNICAL_CHANGES_LOG.md"],
      "description": "Documenting current project state as baseline for future changes",
      "technical_details": {
        "navigation_system": {
          "description": "Custom navigation bar with animated outline (100ms ValueAnimator)",
          "items": [
            "4 active navigation items: Saved, Home, Chats, Profile",
            "Create button (center) is placeholder - no action implemented",
            "Outline movement based on SVG icon positions with precise dp offsets"
          ]
        },
        "map_configuration": {
          "sdk": "Mapbox SDK 10.16.1",
          "features": [
            "Custom location pulse animation (pink #FB86BB, 20% opacity)",
            "Animation: 3.5 to 35 meters radius, 2-second cycle",
            "Gestures: Pan and pinch-to-zoom enabled, rotation disabled",
            "Location updates: 10-second intervals with HIGH_ACCURACY priority",
            "Geocoding: Fallback chain (locality > subAdminArea > adminArea)"
          ]
        },
        "build_configuration": [
          "Kotlin with Gradle Kotlin DSL",
          "Firebase integration (Firestore, Auth, Storage)",
          "Google Services (Places API, Maps, Location)",
          "Networking: OkHttp, Retrofit, WebSocket support"
        ],
        "known_issues": [
          "API keys hardcoded in build.gradle.kts (security concern)",
          "Google Places Search implementation disabled but code preserved",
          "Create button in navigation has no functionality"
        ],
        "animation_lifecycle": [
          "Proper pause/resume with fragment lifecycle",
          "Coroutines with Main dispatcher + Job",
          "Cleanup in onDestroy()"
        ]
      },
      "breaking_changes": false,
      "testing_notes": "Review current implementation against this baseline",
      "related_issues": null,
      "code_snippets": null
    },
    {
      "id": 3,
      "date": "2025-01-23",
      "time": "21:35",
      "author": "Claude/Assistant",
      "category": "UI",
      "files": ["app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt"],
      "description": "Disabled Mapbox scale bar (mile-radius indicator) to provide cleaner map interface",
      "technical_details": [
        "Added import for com.mapbox.maps.plugin.scalebar.scalebar",
        "Added mapView.scalebar.enabled = false in the initializeMap() function",
        "Set right after disabling the location component and before gesture configuration",
        "The scale bar (showing distance/radius measurements) will no longer appear on the map"
      ],
      "breaking_changes": false,
      "testing_notes": [
        "Launch app and navigate to the Home screen with the map",
        "Verify that no scale bar appears in any corner of the map",
        "Test at different zoom levels - the scale bar should never appear",
        "Pinch to zoom in/out and pan around - scale bar should remain hidden"
      ],
      "related_issues": null,
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "// CRITICAL: Disable the scale bar (mile-radius bar) completely\nmapView.scalebar.enabled = false"
        }
      ]
    },
    {
      "id": 4,
      "date": "2025-01-23",
      "time": "21:54",
      "author": "Claude/Assistant",
      "category": "Bug Fix",
      "files": ["app/src/main/res/values/themes.xml"],
      "description": "Fixed duplicate theme definition build error",
      "technical_details": [
        "Removed duplicate Theme.ChatCityOfficial definition from themes.xml",
        "Theme was defined in both styles.xml and themes.xml causing resource merger conflict",
        "Kept the more complete definition in styles.xml which includes all related styles",
        "themes.xml now only contains the Theme.SplashScreen style",
        "Build error was: Duplicate resources: [style/Theme.ChatCityOfficial]"
      ],
      "breaking_changes": false,
      "testing_notes": [
        "Run ./gradlew clean to clear build cache",
        "Run ./gradlew assembleDebug - build should complete successfully",
        "Verify app launches normally with correct theming"
      ],
      "related_issues": null,
      "code_snippets": null
    },
    {
      "id": 5,
      "date": "2025-01-23",
      "time": "23:04",
      "author": "Claude/Assistant",
      "category": "Feature",
      "files": [
        "app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt",
        "app/src/main/res/layout/fragment_home.xml",
        "app/src/main/java/com/chatcityofficial/chatmapapp/SplashActivity.kt"
      ],
      "description": "Implemented sunrise/sunset-based theme switching and edge-to-edge splash screen",
      "technical_details": {
        "day_night_theme": [
          "Added SunriseSunsetCalculator integration to determine sunrise/sunset times based on location",
          "Map automatically switches between Style.DARK (after sunset) and Style.LIGHT (after sunrise)",
          "Logo color changes: white in dark mode, black in light mode",
          "Theme checks run every 5 minutes and on location updates",
          "Added proper lifecycle management for theme update handler",
          "ColorFilter applied to logo ImageView based on current theme"
        ],
        "splash_screen": [
          "Implemented WindowCompat.setDecorFitsSystemWindows(window, false) for true edge-to-edge",
          "Added support for display cutouts (notches) with LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES",
          "Made status bar and navigation bar fully transparent",
          "Added proper API level checks for compatibility (API 30+ and older versions)",
          "WindowInsetsControllerCompat for modern immersive mode implementation",
          "Re-applies edge-to-edge on window focus changes to maintain immersive experience"
        ]
      },
      "breaking_changes": false,
      "testing_notes": [
        "Theme Switching: Test app during day and night times, verify map switches to dark theme after sunset",
        "Splash Screen: Test on devices with notches/cutouts, verify gradient extends to all screen edges"
      ],
      "related_issues": null,
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "val shouldUseDarkTheme = now.after(sunset) || now.before(sunrise)\nval newStyle = if (isDarkMode) Style.DARK else Style.LIGHT"
        }
      ]
    },
    {
      "id": 6,
      "date": "2025-08-14",
      "time": "23:35",
      "author": "Claude/Assistant",
      "category": "Bug Fix",
      "files": ["app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt"],
      "description": "Fixed location puck centering, theme flashing, and removed Mapbox branding",
      "technical_details": {
        "location_puck_fix": [
          "Added separate center dot annotation that stays at exact location coordinates",
          "Created centerDotAnnotation with 2.0 meter radius, fully opaque pink (#FB86BB)",
          "Pulse animation now only affects the expanding ring, not the center dot",
          "Both annotations share the same Point.fromLngLat(location.longitude, location.latitude)",
          "Modified createLocationPuck() function to create both annotations"
        ],
        "theme_flashing_fix": [
          "Changed default map style from Style.MAPBOX_STREETS to Style.DARK",
          "Changed default isDarkMode from false to true",
          "Added determinateInitialTheme() function to pre-calculate theme before map loads",
          "Prevents white/light theme from briefly appearing on load",
          "Theme determined using last known location if available"
        ],
        "mapbox_branding_removal": [
          "Added imports for logo and attribution plugins",
          "Disabled Mapbox logo: mapView.logo.enabled = false",
          "Disabled attribution icon: mapView.attribution.enabled = false",
          "Re-applies these settings in onResume() to ensure they stay hidden",
          "Re-applies after theme changes in updateMapThemeBasedOnTime()"
        ]
      },
      "breaking_changes": false,
      "testing_notes": [
        "Location Puck: Verify center dot stays fixed while pulse expands",
        "Theme Flashing: Force close and restart, verify no white flash",
        "Mapbox Branding: Check all corners for no logo or attribution icon"
      ],
      "related_issues": null,
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "// CRITICAL: Disable all Mapbox branding and UI elements\nmapView.logo.enabled = false\nmapView.attribution.enabled = false\nmapView.scalebar.enabled = false"
        }
      ]
    },
    {
      "id": 7,
      "date": "2025-08-14",
      "time": "19:47",
      "author": "Claude/Assistant",
      "category": "UX",
      "files": ["app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt"],
      "description": "Implemented map camera position persistence when switching between screens",
      "technical_details": [
        "Added savedCameraState as companion object variable to persist camera position",
        "Added hasInitializedCamera flag to track initial camera setup completion",
        "Created saveCameraState() function to capture camera position, zoom, bearing, pitch",
        "Camera state saved in onStop() and onPause() lifecycle methods",
        "Camera state restored in initializeMap() when fragment is recreated",
        "Modified getCurrentLocation() to only move camera on first initialization",
        "Removed automatic camera panning from location updates",
        "Camera state saved before theme changes to maintain position"
      ],
      "breaking_changes": false,
      "testing_notes": [
        "Position Persistence: Pan/zoom map, switch tabs, return - should show last position",
        "First Load: Force close and restart, verify centers on location first time",
        "Location Updates: Pan away from location, wait 10s, verify puck moves but camera doesn't",
        "Theme Changes: Pan to area during day/night transition, verify position maintained"
      ],
      "related_issues": null,
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "private fun saveCameraState() {\n    savedCameraState = mapView.getMapboxMap().cameraState\n}"
        }
      ]
    },
    {
      "id": 8,
      "date": "2025-08-14",
      "time": "20:04",
      "author": "Claude/Assistant",
      "category": "UI/UX",
      "files": [
        "app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt",
        "app/src/main/res/layout/fragment_home.xml",
        "app/src/main/java/com/chatcityofficial/chatmapapp/ui/chats/ChatsFragment.kt"
      ],
      "description": "Fixed location puck layering, aligned Chat City logo with navigation bar, and removed error messages from Chats screen",
      "technical_details": {
        "puck_layering": [
          "Changed order of annotation creation in createLocationPuck()",
          "Pulse animation created FIRST, center dot created AFTER",
          "Ensures center dot appears on top of pulse animation",
          "Annotations rendered in creation order (first = bottom, last = top)"
        ],
        "logo_alignment": [
          "Changed logo left margin from 28dp to 16dp in fragment_home.xml",
          "Aligns leftmost edge of 'C' in Chat City with navigation bar edge",
          "Navigation bar icons have 28dp margin, logo needs 16dp due to internal spacing"
        ],
        "error_messages": [
          "Commented out all Toast.makeText() calls in ChatsFragment.kt",
          "Errors still logged with Log.e() for debugging",
          "Prevents user-facing error messages when navigating to Chats",
          "Silent failures provide cleaner UX while maintaining debug capability"
        ]
      },
      "breaking_changes": false,
      "testing_notes": [
        "Puck Layering: Verify pink center dot visible on top of expanding pulse",
        "Logo Alignment: Check 'C' aligns with left edge of navigation icons",
        "Chats Errors: Navigate to Chats, no error toasts should appear"
      ],
      "related_issues": null,
      "code_snippets": null
    },
    {
      "id": 9,
      "date": "2025-08-15",
      "time": "01:35",
      "author": "Claude/Assistant",
      "category": "Feature",
      "files": [
        "app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt",
        "app/src/main/res/layout/fragment_home.xml",
        "app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/PlaceSearchAdapter.kt (created)",
        "app/src/main/res/layout/item_place_search.xml (created)",
        "app/src/main/res/drawable/ic_search_bar.xml (created)",
        "app/src/main/res/drawable/ic_close.xml (created)",
        "app/src/main/res/drawable/ic_arrow_back.xml (created)",
        "app/src/main/res/values/strings.xml"
      ],
      "description": "Implemented Google Places search functionality with animated UI transitions",
      "technical_details": {
        "core_implementation": [
          "Integrated Google Places API for location search with autocomplete",
          "Added session tokens for optimized billing with Places API",
          "Location-biased search results prioritizing places near current location",
          "Support for: addresses, zip codes, cities, towns, parks, bodies of water, businesses"
        ],
        "ui_components": [
          "Custom search bar that fades in when location icon is tapped",
          "RecyclerView with PlaceSearchAdapter for displaying autocomplete results",
          "Material Design CardView for search results with location icons",
          "Powered by Google attribution text above search bar"
        ],
        "animations": [
          "Initial implementation with 200ms fade in/out animations",
          "Smooth transitions between default view and search view",
          "Keyboard automatically shows when entering search mode"
        ],
        "place_selection": [
          "Camera flies to location with 17.0 zoom level when selected",
          "Attempts to outline selected place with pink (#4DFB86BB) 30% opacity border",
          "Uses place viewport for determining outline bounds",
          "Polygon annotation for place outlining (no fill, only stroke)"
        ]
      },
      "breaking_changes": false,
      "testing_notes": [
        "Tap location icon to open search",
        "Type any location (minimum 3 characters)",
        "Select from autocomplete results",
        "Verify map flies to selected location",
        "Check that place is outlined with pink border"
      ],
      "related_issues": null,
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "if (!Places.isInitialized()) {\n    Places.initialize(requireContext(), getString(R.string.google_maps_api_key))\n}\nplacesClient = Places.createClient(requireContext())"
        }
      ]
    },
    {
      "id": 10,
      "date": "2025-08-15",
      "time": "01:50",
      "author": "Claude/Assistant",
      "category": "UX",
      "files": [
        "app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt",
        "app/src/main/res/layout/fragment_home.xml"
      ],
      "description": "Improved search functionality UX with better tap detection, faster animations, and map tap to close",
      "technical_details": [
        "Made entire location container clickable with android:clickable=true",
        "Added android:foreground=?attr/selectableItemBackground for touch feedback",
        "Both container and icon are clickable for redundancy",
        "Added isSearchVisible flag to prevent double triggers",
        "Moved Powered by Google text ABOVE search bar",
        "Search container marginTop adjusted to 70dp",
        "Added mapView.getMapboxMap().addOnMapClickListener to close search on map tap",
        "Reduced animation duration from 200ms to 100ms",
        "Search automatically hides after place selection",
        "Clear search results when hiding search view",
        "Proper keyboard management",
        "Session token regenerated after each place selection"
      ],
      "breaking_changes": false,
      "testing_notes": [
        "Tap Detection: Tap anywhere on location container",
        "Animation Speed: Verify 100ms transitions feel responsive",
        "Map Tap: Open search, tap on map - should close search",
        "Search Flow: Select a place - verify search closes and map moves",
        "Powered by Google: Check text appears above search bar"
      ],
      "related_issues": null,
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "companion object {\n    private const val ANIMATION_DURATION = 100L // Changed from 200ms\n}"
        }
      ]
    },
    {
      "id": 11,
      "date": "2025-08-15",
      "time": "02:19",
      "author": "Claude/Assistant",
      "category": "Bug Fix",
      "files": ["app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt"],
      "description": "Fixed Mapbox SDK v10 compilation error by using gestures plugin for map click listener",
      "technical_details": [
        "Replaced deprecated mapView.getMapboxMap().addOnMapClickListener",
        "Now using mapView.gestures.addOnMapClickListener",
        "In Mapbox SDK v10, map click listeners accessed through gestures plugin",
        "Added import for com.mapbox.maps.plugin.gestures.addOnMapClickListener",
        "Gestures plugin method has same signature and behavior as deprecated method",
        "Fixes compilation error: Unresolved reference: addOnMapClickListener"
      ],
      "breaking_changes": false,
      "testing_notes": [
        "Run ./gradlew clean to clear build cache",
        "Run ./gradlew assembleDebug - build should complete successfully",
        "Test map tap functionality: Open search, tap map, verify closes properly",
        "Ensure no other click handlers are affected"
      ],
      "related_issues": null,
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "mapView.gestures.addOnMapClickListener { point ->\n    if (isSearchVisible) {\n        hideSearchView()\n        true // Consume the click event\n    } else {\n        false\n    }\n}"
        }
      ]
    },
    {
      "id": 12,
      "date": "2025-08-15",
      "time": "14:06",
      "author": "Claude/Assistant",
      "category": "UX/Feature",
      "files": [
        "app/src/main/java/com/chatcityofficial/chatmapapp/MainActivity.kt",
        "app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt"
      ],
      "description": "Implemented improved back button behavior and fixed initial app launch to center on user location",
      "technical_details": {
        "back_button": [
          "Added OnBackPressedCallback to handle system back button presses",
          "Added currentDestinationId tracking to know which screen is active",
          "When on home screen: back button minimizes app using moveTaskToBack(true)",
          "When on other screens: back button navigates to home and moves outline",
          "Import added: androidx.activity.OnBackPressedCallback"
        ],
        "search_bar_confirmed": [
          "Confirmed existing implementation: tapping anywhere on map closes search bar",
          "Already properly implemented with mapView.gestures.addOnMapClickListener",
          "No changes needed - working as requested"
        ],
        "initial_location": [
          "Reset hasInitializedCamera flag to false in onCreateView() for fresh fragment",
          "Ensures app always centers on user location when launched",
          "Modified camera initialization logic to prioritize initial centering",
          "Only skip centering if both: hasInitializedCamera is true AND savedCameraState exists",
          "Added fallback: if initialized but no saved state, still center on location",
          "Added public methods: isSearchViewVisible() and hideSearchViewIfVisible()"
        ]
      },
      "breaking_changes": false,
      "testing_notes": [
        "Back Button: From Home press back - app minimizes, from other screens - returns to Home",
        "Search Bar: Open search, tap map, verify closes and default UI returns",
        "Initial Location: Force close app, launch fresh, verify centers on user location"
      ],
      "related_issues": null,
      "code_snippets": null
    },
    {
      "id": 13,
      "date": "2025-08-16",
      "time": "15:30",
      "author": "Claude/Assistant",
      "category": "UX/Feature",
      "files": [
        "app/src/main/java/com/chatcityofficial/chatmapapp/MainActivity.kt",
        "app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt"
      ],
      "description": "Enhanced navigation stack handling and implemented persistent camera view across app sessions",
      "technical_details": {
        "enhanced_back_navigation": [
          "Improved OnBackPressedCallback to properly handle navigation stack",
          "Added check for HomeFragment search visibility before navigation",
          "Uses navController.popBackStack() for proper back stack handling",
          "Handles nested navigation (chat threads, settings) before returning to root tabs",
          "Clear back stack when navigating to new root destination"
        ],
        "persistent_camera": [
          "Implemented SharedPreferences to persist camera state across app sessions",
          "Camera position saved to disk on every change (lat, lng, zoom, bearing, pitch)",
          "On app launch, loads last saved camera position instead of centering on user",
          "Only centers on user location on very first app install",
          "Added loadPersistedCameraState() and persistCameraState() functions",
          "SharedPreferences keys: KEY_CAMERA_LAT, KEY_CAMERA_LNG, KEY_CAMERA_ZOOM, etc."
        ],
        "consistent_camera": [
          "Camera state saved in onPause() and onStop() lifecycle methods",
          "Camera state persisted to SharedPreferences for cross-session persistence",
          "Camera position remains unchanged when navigating between tabs",
          "Camera position maintained when using back button navigation",
          "hasEverInitialized flag tracks whether app has ever been launched before"
        ]
      },
      "breaking_changes": false,
      "testing_notes": [
        "Back Navigation: Test nested navigation, verify proper back stack handling",
        "Camera Persistence: Pan/zoom, force close, relaunch - should show last position",
        "Camera Consistency: Switch tabs, use back button - camera view unchanged"
      ],
      "related_issues": null,
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "private fun persistCameraState() {\n    val currentState = mapView.getMapboxMap().cameraState\n    val prefs = requireContext().getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE)\n    \n    currentState.center?.let { center ->\n        prefs.edit().apply {\n            putFloat(KEY_CAMERA_LAT, center.latitude().toFloat())\n            putFloat(KEY_CAMERA_LNG, center.longitude().toFloat())\n            putFloat(KEY_CAMERA_ZOOM, currentState.zoom.toFloat())\n            putFloat(KEY_CAMERA_BEARING, currentState.bearing.toFloat())\n            putFloat(KEY_CAMERA_PITCH, currentState.pitch.toFloat())\n            putBoolean(KEY_HAS_SAVED_CAMERA, true)\n            apply()\n        }\n    }\n}"
        }
      ]
    },
    {
      "id": 14,
      "date": "2025-08-17",
      "time": "17:43",
      "author": "Claude/Assistant",
      "category": "Bug Fix",
      "files": ["app/src/main/java/com/chatcityofficial/chatmapapp/ui/home/HomeFragment.kt"],
      "description": "Fixed map tap to close search functionality by properly implementing Mapbox gestures plugin",
      "technical_details": {
        "issue": "Map tap to close search was not working despite being documented as implemented. The previous implementation used setOnTouchListener which doesn't properly integrate with Mapbox's gesture system.",
        "solution": [
          "Removed problematic setOnTouchListener implementation that was intercepting touch events",
          "Properly implemented mapView.gestures.addOnMapClickListener using Mapbox SDK v10's gestures plugin",
          "Added necessary import: com.mapbox.maps.plugin.gestures.addOnMapClickListener",
          "Click listener added in two places to ensure persistence:",
          "1. In initializeMap() after map style loads",
          "2. In updateMapThemeBasedOnTime() after theme changes to re-attach listener"
        ],
        "why_previous_failed": [
          "setOnTouchListener intercepts raw touch events before Mapbox processes them",
          "This approach conflicts with Mapbox's internal gesture handling",
          "The gestures plugin provides the proper API for map interactions in SDK v10"
        ]
      },
      "breaking_changes": false,
      "testing_notes": [
        "Map Tap to Close: Open search, tap anywhere on map (not on search UI), verify closes immediately",
        "Search UI Works: Open search, interact with search bar and results normally",
        "Theme Changes: Open search, wait for theme change, verify map tap still closes search",
        "Multiple Scenarios: Test with keyboard open/closed, after selecting place, after clearing text"
      ],
      "related_issues": "User reported issue with map tap not closing search",
      "code_snippets": [
        {
          "language": "kotlin",
          "code": "// CRITICAL FIX: Add map click listener using the gestures plugin\nmapView.gestures.addOnMapClickListener { point ->\n    if (isSearchVisible) {\n        Log.d(TAG, \"Map clicked while search is visible - closing search\")\n        hideSearchView()\n        true // Consume the click event\n    } else {\n        false // Let other click handlers process it\n    }\n}"
        }
      ]
    }
  ]
}